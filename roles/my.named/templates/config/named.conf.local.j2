{# roles/my.named/templates/config/named.conf.local.j2 (ENTIRE) #}
# {{ ansible_managed }}
{% if my_named_mode == 'master' %}

{# -- forward master zones -------------------------------------------------- #}
{% for zone in my_named_zones %}
zone "{{ zone }}" {
    type master;
    file "{{ my_named_base_dir }}/db.{{ zone }}";
    allow-transfer { transfers-allowed-by; };
    allow-query    { any; };
    notify yes;
};
{% endfor %}

{# -- reverse master zones (auto-generated) --------------------------------- #}
{% if my_named_reverse_zone_definitions is defined %}
{% for rv in my_named_reverse_zone_definitions %}
zone "{{ rv.name }}" {
    type master;
    file "{{ my_named_base_dir }}/db.{{ rv.name }}";
    allow-transfer { transfers-allowed-by; };
    allow-query    { any; };
    notify yes;
};
{% endfor %}
{% endif %}

{% else %}

{# -- forward slave zones --------------------------------------------------- #}
{% for zone in my_named_zones %}
zone "{{ zone }}" {
    type slave;
    file "{{ my_named_base_dir }}/db.{{ zone }}";
    allow-query { any; };
    masters { {{ my_named_master_ip }}; };
};
{% endfor %}

{# -- reverse slave zones (only if provided) -------------------------------- #}
{% if my_named_reverse_zone_definitions is defined %}
{% for rv in my_named_reverse_zone_definitions %}
zone "{{ rv.name }}" {
    type slave;
    file "{{ my_named_base_dir }}/db.{{ rv.name }}";
    allow-query { any; };
    masters { {{ my_named_master_ip }}; };
};
{% endfor %}
{% endif %}

{% endif %}
